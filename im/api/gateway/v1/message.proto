syntax = "proto3";

package webitel.im.api.gateway.v1;


import "google/api/annotations.proto";
import "api/gateway/v1/peer.proto";

option go_package = "github.com/webitel/im-gateway-service/gen/api/gateway/v1;gateway";

// Messenger delivers messages from external API to the internal thread system.
service Message {
  // SendText delivers a plain text message.
  // We use the shared Request/Response types directly to avoid duplication.
  rpc SendText(SendTextRequest) returns (SendTextResponse) {
    option (google.api.http) = {
      post: "/v1/messages/text"
      body: "*"
    };
  }

  // SendFile delivers documents or files.
  rpc SendFile(SendDocumentRequest) returns (SendDocumentResponse) {
    option (google.api.http) = {
      post: "/v1/messages/file"
      body: "*"
    };
  }

  // SendImage delivers image-specific messages.
  rpc SendImage(SendImageRequest) returns (SendImageResponse) {
    option (google.api.http) = {
      post: "/v1/messages/image"
      body: "*"
    };
  }
}


// Represents a request to send a text message.
message SendTextRequest {
  Peer   to          = 1;
  string body        = 2;
}

// Represents a response to send a text message.
message SendTextResponse {
  Peer to = 1;
  string id = 2;
}

// Represents `Document` message with necessary fields
// to process it into frequently used `document`
// entity in messaging systems.
message DocumentInput {
  string id = 1;
  string url = 2;
  string file_name = 3; 
  string mime_type = 4;
  optional int64 size_bytes = 5;
}

message DocumentRequest {
  repeated DocumentInput documents = 1;
  string body = 2; 
}

// Represents a request to send a message with document.
message SendDocumentRequest {
  Peer   to                = 1;
  DocumentRequest document = 2;
}

// Represents a response to send message with document. 
message SendDocumentResponse {
  Peer to = 1;
  string id = 2;
}

// Represents `Image` entity with 
// necessary fields. 
message ImageInput {
  string id = 1;
  string name = 2;
  string link = 3;
  string mime_type = 4;
}

message ImageRequest {
  repeated ImageInput images = 1;
  string body = 2;
}

// Represents a request to send an message with image.
message SendImageRequest {
  Peer   to          = 1;
  ImageRequest image = 2;
}

// Represents a response to send message with image.
message SendImageResponse {
    Peer to = 1;
    string id = 2;
}