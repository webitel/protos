syntax = "proto3";

package webitel.im.api.gateway.v1;

option go_package = "github.com/webitel/im-gateway-service/gen/api/gateway/v1;gateway";

import "api/gateway/v1/oauth.proto";
import "api/gateway/v1/device_push.proto";
import "api/gateway/v1/authorization.proto";
import "api/gateway/v1/device.proto";
import "api/gateway/v1/contact.proto";

import "google/api/annotations.proto";

// End-User Account Service
service Account {

  //
  // --- Notifications --- //
  //
  // registerDevice 	Register device to receive PUSH notifications
  // unregisterDevice 	Deletes a device by its token, stops sending PUSH-notifications to it.
  // getNotifySettings 	Gets current notification settings for a given user/group, from all users/all groups.
  // updateNotifySettings 	Edits notification settings from a given user/group, from all users/all groups.
  // resetNotifySettings 	Resets all notification settings from users and groups.
  //
  // --- Users --- //
  //
  // users.getFullUser 	Returns extended user info by ID.
  // users.getUsers 	Returns basic user info according to their identifiers.
  // contacts.resolvePhone 	Resolve a phone number to get user info, if their privacy settings allow it.

  // // Authorization Request. Part of OAuth flow
  // rpc Auth(AuthRequest) returns (AuthResponse);
  rpc Token(TokenRequest) returns (Authorization) {
    option (google.api.http) = {
      post: "/v1/auth/token"
      body: "*"
      response_body: "*"
    };
  }

  // Inspect current Authorization credentials
  rpc Inspect(InspectRequest) returns (Authorization) {
    option (google.api.http) = {
      get: "/v1/auth/token"
    };
  }

  // Logout Device Request
  rpc Logout(LogoutRequest) returns (LogoutResponse) {
    option (google.api.http) = {
      post: "/v1/auth/logout"
    };
  }

  // Register device to receive PUSH notifications
  rpc RegisterDevice(RegisterDeviceRequest) returns (RegisterDeviceResponse)  {
    option (google.api.http) = {
      put: "/v1/auth/device"
      body: "push"
    };
  }

  // Deletes a device by its token, stops sending PUSH-notifications to it.
  rpc UnregisterDevice(UnregisterDeviceRequest) returns (UnregisterDeviceResponse) {
    option (google.api.http) = {
      delete: "/v1/auth/device"
      body: "push"
    };
  }
}




// PUSH Subscription
// https://core.telegram.org/api/gateway/push-updates#subscribing-to-notifications
message RegisterDeviceRequest {
  // PUSH Notification subscription
  webitel.im.api.gateway.v1.PUSHSubscription push = 1;
}

message RegisterDeviceResponse {
  // No Reply ; Error status if failed
}

// PUSH Subscription
// https://core.telegram.org/api/gateway/push-updates#subscribing-to-notifications
message UnregisterDeviceRequest {
  // PUSH Notification subscription
  PUSHSubscription push = 1;
}

message UnregisterDeviceResponse {
  // No Reply ; Error status if failed
}
