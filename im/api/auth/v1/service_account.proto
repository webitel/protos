syntax = "proto3";

package webitel.im.api.auth.v1;
import "domain/auth/v1/device.proto";
import "domain/auth/v1/contact.proto";


option go_package = "github.com/webitel/messaging/proto/gen/webitel/messaging/auth/v1;adpb";

import "domain/auth/v1/oauth.proto";
import "domain/auth/v1/device_push.proto";
import "domain/auth/v1/authorization.proto";

// End-User Account Service
service Account {

  //
  // --- Notifications --- //
  //
  // registerDevice 	Register device to receive PUSH notifications
  // unregisterDevice 	Deletes a device by its token, stops sending PUSH-notifications to it.
  // getNotifySettings 	Gets current notification settings for a given user/group, from all users/all groups.
  // updateNotifySettings 	Edits notification settings from a given user/group, from all users/all groups.
  // resetNotifySettings 	Resets all notification settings from users and groups.
  //
  // --- Users --- //
  //
  // users.getFullUser 	Returns extended user info by ID.
  // users.getUsers 	Returns basic user info according to their identifiers.
  // contacts.resolvePhone 	Resolve a phone number to get user info, if their privacy settings allow it.

  // // Authorization Request. Part of OAuth flow
  // rpc Auth(AuthRequest) returns (AuthResponse);
  
  // Access Token Request
  rpc Token(domain.auth.v1.TokenRequest) returns (Authorization); // (AccessToken);
  // Logout Device Request
  rpc Logout(domain.auth.v1.LogoutRequest) returns (domain.auth.v1.LogoutResponse);
  // Inspect Token Request
  rpc Inspect(domain.auth.v1.InspectRequest) returns (domain.auth.v1.Authorization); // (InspectToken);


  // Register device to receive PUSH notifications
  rpc RegisterDevice(RegisterDeviceRequest) returns (RegisterDeviceResponse);
  // Deletes a device by its token, stops sending PUSH-notifications to it.
  rpc UnregisterDevice(UnregisterDeviceRequest) returns (UnregisterDeviceResponse);
  
  // Get logged-in session(s)
  // https://core.telegram.org/method/account.getAuthorizations
  // rpc GetAuthorizations(GetAuthorizationRequest) returns (AuthorizationList);
  
  // rpc GetSessions(GetSessionRequest) returns (SessionList);
  
  // Get my (end-user) device (session) list
  // rpc GetDevices()
}


message Authorization {
    // Business (Domain) Account ID
  int64 dc = 1;
  // When was the session created
  int64 date = 3;
  // Session (device) display name.
  string name = 4;
  // Application [client_id] ; VIA
  string app_id = 5;
  // Last known (User-Agent) device ; FROM
  domain.auth.v1.Device device = 6;
  // Authorized end-user Contact info
  domain.auth.v1.AuthContact contact = 7;
  // Whether this is the current session
  bool current = 9;
}

// PUSH Subscription
// https://core.telegram.org/api/push-updates#subscribing-to-notifications
message RegisterDeviceRequest {
  // PUSH Notification subscription
  domain.auth.v1.PUSHSubscription push = 1;
}

message RegisterDeviceResponse {
  // No Reply ; Error status if failed
}

// PUSH Subscription
// https://core.telegram.org/api/push-updates#subscribing-to-notifications
message UnregisterDeviceRequest {
  // PUSH Notification subscription
  domain.auth.v1.PUSHSubscription push = 1;
}

message UnregisterDeviceResponse {
  // No Reply ; Error status if failed
}