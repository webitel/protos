syntax = "proto3";

package webitel.im.shared.contact.v1;

import "google/protobuf/struct.proto";
import "buf/validate/validate.proto";

option go_package = "github.com/webitel/im-contact-service/gen/go/api/v1;impb";

message SearchContactRequest {
  int32 page = 1;
  int32 size = 2;
  string q = 3;

  string sort = 4;
  repeated string fields = 5;


  repeated string app_id = 6;
  repeated string iss_id = 7;
  repeated string type = 8;
  repeated string ids = 9;
  repeated string subjects = 10;
}

message CreateContactRequest {
  // Issuer of the Contact
  string iss_id = 1 [(buf.validate.field).required = true];
  string app_id = 3 [(buf.validate.field).required = true];

  // Type of the Contact
  string type = 4 [(buf.validate.field).required = true];

  // Display name
  string name = 5;
  // Username unique inside issuer
  string username = 6
  [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).required = true
  ];
  // Optional metadata
  map<string, string> metadata = 7;
  string subject = 8 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).required = true
  ];
}

message UpdateContactRequest {
  // Unique internal Contact ID
  string id = 1 [(buf.validate.field).string.uuid = true];

  // Display name
  string name = 2;
  // Username unique inside issuer
  string username = 3 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).required = true
  ];
  // Optional metadata
  map<string, string> metadata = 4;
  string subject = 5 [
    (buf.validate.field).string.min_len = 1
  ];
}


message DeleteContactRequest {
  string id = 1 [(buf.validate.field).string.uuid = true];
}

message CanSendRequest {
  message Peer {
    oneof kind {
      string contact_id = 1[
        (buf.validate.field).string.uuid = true
      ];
      string bot_id = 2[
        (buf.validate.field).string.uuid = true
      ];
    }
  }

  Peer from = 1;
  Peer to = 2;
  int32 domain_id = 3;
}

message CanSendResponse {
  bool can = 1;
}



message ContactList {
  int32 page = 1;
  int32 size = 2;
  bool next = 3;
  repeated Contact contacts = 4;
}



message Contact {
  string id = 1;
  string iss_id = 2;
  string app_id = 4;
  string type = 5;

  string name = 6;
  string username = 7;
  map<string, string> metadata = 8;

  int64 created_at = 9;

  int64 updated_at = 10;
  string subject = 11;
}



enum UnableSendReason {
  UNDEFINED = 0;
  CONTACT_NOT_FOUND = 1;
}
