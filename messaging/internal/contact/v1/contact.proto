syntax = "proto3";

package webitel.messaging.internal.contact.v1;

import "google/protobuf/struct.proto";

option go_package = "github.com/webitel/contact/proto/gen/webitel/messaging/v1;impb";


service Contacts {
  rpc SearchContact(SearchContactRequest) returns (ContactList);
  rpc CreateContact(CreateContactRequest) returns (Contact);
  rpc UpdateContact(UpdateContactRequest) returns (Contact);
  rpc DeleteContact(DeleteContactRequest) returns (Contact);

  rpc CanSend(CanSendRequest) returns (CanSendResponse);
}

message SearchContactRequest {
  int32 page = 1;
  int32 size = 2;
  string q = 3;

  string sort = 4;
  repeated string fields = 5;


  repeated string app_id = 6;
  repeated string iss_id = 7;
  repeated string type = 8;
  repeated string ids = 9;
}

message CreateContactRequest {
  // Issuer of the Contact
  string iss_id = 1;

  string app_id = 3;

  // Type of the Contact
  string type = 4;

  // Display name
  string name = 5;
  // Username unique inside issuer
  string username = 6;
  // Optional metadata
  google.protobuf.Struct metadata = 7;
}

message UpdateContactRequest {
  // Unique internal Contact ID
  string id = 1;

  // Display name
  string name = 2;
  // Username unique inside issuer
  string username = 3;
  // Optional metadata
  google.protobuf.Struct metadata = 4;
}


message DeleteContactRequest {
  string id = 1;
}


message GetContactRequest {
  string id = 1;
}

message CanSendRequest {
  string from_id = 1;
  string to_id = 2;
}

message CanSendResponse {
  bool can = 1;
  UnableSendReason reason = 2;
  string details = 3;
}



message ContactList {
  int32 page = 1;
  int32 size = 2;
  repeated Contact contacts = 3;
}



message Contact {
  string id = 1;
  string iss_id = 2;
  string app_id = 4;
  string type = 5;

  string name = 6;
  string username = 7;
  google.protobuf.Struct metadata = 8;

  int64 created_at = 9;

  int64 updated_at = 10;
}



enum UnableSendReason {
  Undefined = 0;
  ContactNotFound = 1;
}


