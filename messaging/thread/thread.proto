syntax = "proto3";

package thread.v1;

import "google/protobuf/empty.proto";

option go_package = "github.com/webitel/im/api/thread;thread";

// ==========================================================
// Thread Service â€” Core Messaging Domain
// ==========================================================
//
// Responsibility:
// - Resolve or create threads
// - Accept new messages (idempotent)
// - Publish canonical events to message broker

service ThreadService {
  // Explicit thread creation (optional for MVP UI flows).
  rpc CreateThread(CreateThreadRequest) returns (CreateThreadResponse);

  // Find an existing thread between two peers.
  rpc SearchThread(SearchThreadRequest) returns (SearchThreadResponse);
}



// Thread represents a conversation unit.
message Thread {

  // Canonical thread identifier, assigned by server.
  string id = 1;

  ThreadType type = 2;

  repeated Member members = 3;
}

// Thread type defines conversation semantics.
enum ThreadType {
  THREAD_TYPE_UNSPECIFIED = 0;
  THREAD_TYPE_DIRECT = 1; // 1-to-1 chat
  THREAD_TYPE_GROUP = 2;  // Group or channel chat
}

// Member represents participation of a contact in a thread.
message Member {
  string thread_id = 1;
  string contact_id = 2;
}


// Explicit thread creation.
message CreateThreadRequest {
  Peer from_peer = 1;
  Peer to_peer = 2;
}

message CreateThreadResponse {
  Thread thread = 1;
}

// Thread lookup between two peers.
message SearchThreadRequest {
  Peer from_peer = 1;
  Peer to_peer = 2;
}

message SearchThreadResponse {
  Thread thread = 1;
}
